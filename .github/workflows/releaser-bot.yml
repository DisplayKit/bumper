name: PR comment
on:
  issue_comment:                                     
    types: [created, edited]

env:
  GITHUB_REPOSITORY: "displaykit/bump-release"
  GITHUB_PR_NUMBER: ${{ github.event.issue.number }}
  GITHUB_TOKEN: ${{ secrets.GH_GLOBAL_TOKEN }}
  COMMIT_USERNAME: "CI Bot - DevSoutinho"
  COMMIT_EMAIL: "13791385+omariosouto@users.noreply.github.com"

jobs:
  comment_checker:
    if: contains(github.event.comment.html_url, '/pull/')    # check if the comments come from pull request, exclude those from issue.
    runs-on: ubuntu-latest
    steps:
      ## [Setup_CI]
      # ======================
      - name: Get branch name
        id: branchName
        run: echo ::set-output name=branch::$(echo $PR_COMMENT | cut -d "[" -f2 | cut -d "]" -f1)
        env:
          PR_COMMENT: ${{ github.event.comment.body }}
      - uses: actions/checkout@v2
        with: 
          ref: ${{ steps.branchName.outputs.branch }}
      - uses: actions/setup-node@v3
        with:
          node-version: 18
      # ======================
      - name: "[RELEASE]"
        if: contains(github.event.comment.body, '/release/') # support|major|minor|patch
        run: | 
          cat .git/HEAD
          yarn install && yarn setup
          git config --global user.name "${{ env.COMMIT_USERNAME }}"
          git config --global user.email ${{ env.COMMIT_EMAIL }}
          bump-release ${{ github.event.comment.body }}
